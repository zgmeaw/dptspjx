# 使用指南和问题解决方案

## 🎯 核心问题分析和解决方案

### 问题1：视频解析成功但无法播放

**原因分析：**
1. **CORS跨域限制**：浏览器的同源策略阻止跨域视频加载
2. **HTTP/HTTPS混合内容**：GitHub Pages使用HTTPS，但API返回HTTP链接
3. **防盗链机制**：视频平台检查Referer头，阻止非官方播放
4. **浏览器安全策略**：Edge等浏览器的增强安全设置

**解决方案：**
- ✅ 移除video标签的`crossorigin`属性，避免CORS预检请求
- ✅ 自动将所有HTTP链接转换为HTTPS
- ✅ 添加视频加载超时检测（15秒）
- ✅ 提供详细的错误代码解析
- ✅ 视频无法播放时自动显示下载选项

### 问题2：下载功能不可靠

**原因分析：**
1. 使用iframe和window.open的方式不稳定
2. 下载触发可能导致页面刷新
3. 没有提供备用下载方案

**解决方案：**
- ✅ 使用HTML5 a标签的download属性
- ✅ 提供详细的手动下载指引
- ✅ 支持多个备用下载链接
- ✅ 显示清晰的下载步骤说明

### 问题3：API安全提示和不稳定

**原因分析：**
1. 前两个API在手动访问时有安全提示
2. 某些API响应速度慢
3. API返回数据格式不统一

**解决方案：**
- ✅ 优化API调用顺序（优先使用稳定的API4和API3）
- ✅ 统一处理所有API的返回数据格式
- ✅ 添加完善的错误处理
- ✅ 保存所有可能的备用URL

## 📋 API返回数据处理

### API1 (api.xinyew.cn)
```javascript
优先级：低（第4顺位）
特点：有安全提示，但数据完整
处理：
- 优先使用 video_url (CDN直链)
- 备用 play_url
- 强制转换为HTTPS
```

### API2 (gy.api.xiaotuo.net)
```javascript
优先级：中（第3顺位）
特点：有安全提示，多清晰度选项
处理：
- 使用 items[0].url
- 保存其他清晰度作为备用
- 强制转换为HTTPS
```

### API3 (api.guiguiya.com)
```javascript
优先级：高（第2顺位）
特点：速度较慢，但稳定
处理：
- 直接使用 data.url
- 强制转换为HTTPS
```

### API4 (api.nxvav.cn)
```javascript
优先级：最高（第1顺位）
特点：最稳定，响应快
处理：
- 直接使用 data.url
- 强制转换为HTTPS
```

## 🎬 视频播放优化

### 1. 视频标签配置
```javascript
// 移除crossorigin避免CORS
player.removeAttribute('crossorigin');

// 基础配置
player.setAttribute('preload', 'auto');
player.setAttribute('playsinline', '');

// iOS兼容
player.setAttribute('webkit-playsinline', '');

// 腾讯X5内核兼容
player.setAttribute('x5-video-player-type', 'h5');
player.setAttribute('x5-video-player-fullscreen', 'true');
```

### 2. 错误处理
```javascript
错误代码 1: 视频加载被中止
错误代码 2: 网络错误导致视频加载失败
错误代码 3: 视频解码失败
错误代码 4: 视频格式不支持或URL无效
```

### 3. 加载超时处理
- 设置15秒加载超时
- 超时后自动显示下载选项
- 提供多个备用链接

## ⬇️ 下载功能使用指南

### 方法1：自动下载（推荐）
1. 点击"下载视频"按钮
2. 浏览器会自动开始下载或打开新标签页
3. 查看浏览器下载管理器

### 方法2：手动下载
1. 点击"点击这里手动打开视频链接"
2. 在新打开的页面中，右键点击视频
3. 选择"视频另存为"
4. 选择保存位置并确认

### 方法3：备用链接
如果主链接失败，系统会提供备用链接：
1. 查看"备用链接"部分
2. 点击"备用链接 1"或"备用链接 2"
3. 按照手动下载步骤操作

## 🔍 常见问题解答

### Q1: 为什么视频无法播放？
**A:** 这是由于视频平台的防盗链机制和浏览器的CORS限制。解决方案：
- 使用下载功能将视频保存到本地
- 尝试使用不同的浏览器
- 使用提供的备用链接

### Q2: 下载按钮点击后没反应？
**A:** 可能的原因和解决方案：
- 浏览器阻止了弹窗 → 允许弹窗权限
- 网络问题 → 检查网络连接
- 链接失效 → 尝试备用链接
- 使用"手动打开视频链接"方式

### Q3: 显示"解析成功"但没有视频？
**A:** 这表示API返回了数据，但视频链接可能有问题：
- 链接可能已过期（重新解析）
- 防盗链限制（使用下载功能）
- 网络环境问题（更换网络或使用VPN）

### Q4: 所有API都解析失败？
**A:** 可能的原因：
- 视频链接格式不正确
- 视频已被删除
- API服务暂时不可用
- 不支持该平台的视频

### Q5: 下载的视频无法播放？
**A:** 可能的原因：
- 下载未完成（检查文件大小）
- 文件损坏（重新下载）
- 播放器不支持该格式（更换播放器，推荐VLC）

## 💡 使用技巧

### 1. 快速解析
- 支持直接粘贴包含链接的文本
- 系统会自动提取链接
- 无需手动清理多余文字

### 2. 批量操作
- 解析一个视频后，可以直接清空输入框
- 粘贴新链接继续解析
- 无需刷新页面

### 3. 移动端使用
- 在视频APP中点击"分享"
- 选择"复制链接"
- 返回浏览器，点击"粘贴"按钮
- 点击"解析视频"

### 4. 最佳实践
- 优先尝试下载功能（最可靠）
- 保存备用链接以防失效
- 遇到问题先尝试重新解析
- 不同视频可能需要不同的API

## 🛡️ 安全建议

### 1. 隐私保护
- 本工具不存储任何数据
- 所有请求直接发送到第三方API
- 不会上传或保存视频内容

### 2. 合理使用
- 仅供个人学习研究使用
- 尊重视频原作者版权
- 不要用于商业用途
- 避免频繁请求导致IP被封

### 3. 浏览器安全
- 建议使用最新版本浏览器
- 启用浏览器的安全防护功能
- 不要在公共电脑上使用
- 及时清理浏览器缓存

## 🔄 故障排除流程

```
1. 确认链接是否正确
   ↓
2. 检查网络连接
   ↓
3. 尝试重新解析
   ↓
4. 查看错误提示
   ↓
5. 尝试下载功能
   ↓
6. 使用备用链接
   ↓
7. 更换浏览器
   ↓
8. 过一段时间再试
```

## 📞 获取帮助

如果遇到问题：
1. 查看本使用指南
2. 查看README.md
3. 提交GitHub Issue
4. 访问项目主页获取最新信息

## 📊 性能优化建议

### 对于开发者
1. 可以添加视频预加载
2. 可以实现视频缓存机制
3. 可以添加更多API接口
4. 可以实现视频格式转换

### 对于用户
1. 使用稳定的网络环境
2. 不要同时解析多个视频
3. 及时清理浏览器缓存
4. 使用推荐的浏览器

---

最后更新：2025-12-04
版本：v2.0.0

